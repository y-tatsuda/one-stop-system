# LIFF買取システム - 実現したいこと

## 現在実装済み

### 買取申込フロー
- [x] LIFFで買取申込フォーム表示
- [x] 機種・容量・ランク選択で事前査定価格表示
- [x] 最低保証価格表示
- [x] ネットワーク利用制限（△）の減額表示
- [x] 申込完了時にLINE自動返信（詳細な申込内容）
- [x] 申込完了時にSlack通知
- [x] WEB経由の場合はメール自動返信（ドメイン認証後）

### 価格管理
- [x] Supabaseの価格マスタで一元管理
- [x] 価格変更すれば全サービス（LINE/WEB/店頭）に反映

---

## 今後実装予定

### 本査定完了フロー
1. **管理画面で「本査定完了」ボタン押下**
   - 本査定金額を入力
   - LINE/メールで通知送信

2. **お客様にLIFFリンク送信**
   - 本査定結果を表示
   - 「承諾する」「返却を希望」ボタン

3. **承諾の場合**
   - 振込先入力フォーム表示
   - 送信完了でSlackに通知
   - 「〇〇様が承諾。振込先: △△銀行...」

4. **返却の場合**
   - 「返却依頼を受け付けました」と表示
   - Slackに通知
   - 「〇〇様が返却希望」

### その他の自動通知
| タイミング | LINE | メール | Slack |
|-----------|------|--------|-------|
| 申込受付 | ✅ | ✅（認証後） | ✅ |
| 本査定完了 | ⚪ | ⚪ | ⚪ |
| お客様承諾 | ⚪ | ⚪ | ⚪ |
| お客様返却希望 | ⚪ | ⚪ | ⚪ |
| 振込完了 | ⚪ | ⚪ | ⚪ |

### Lステップ連携
- [ ] 申込時にタグ付け「買取申込み済」
- [ ] 承諾時にタグ付け「買取承諾済」
- [ ] 振込完了時にタグ付け「買取完了」

---

## 必要な環境変数

| 変数名 | 用途 | 状態 |
|--------|------|------|
| `LINE_CHANNEL_ACCESS_TOKEN` | LINE返信 | ✅ 設定済み |
| `LSTEP_API_KEY` | Lステップタグ付け | ⚪ 未設定 |
| `LSTEP_ACCOUNT_ID` | Lステップアカウント | ⚪ 未設定 |
| `RESEND_API_KEY` | メール送信 | ✅ 設定済み |

---

## メール送信ドメイン

- 使用予定ドメイン: `one-stop.com`（確認中）
- 送信元アドレス例: `support@one-stop.com`
- Resendでのドメイン認証が必要
